{"version":3,"file":null,"sources":["../node_modules/prest-lib/src/main/jsonml.ts","../node_modules/prest-lib/src/main/jsonml-idom.ts","../node_modules/prest-lib/src/main/hash.ts","../node_modules/prest-lib/src/main/widget.ts","../node_modules/prest-lib/src/main/events.ts","../node_modules/prest-lib/src/main/widgete.ts","../src/todowidget.ts","../src/store.ts","../src/todoapp.ts","../src/index.ts"],"sourcesContent":["\nexport interface Attrs {\n    _id?: string;\n    _classes?: string[];\n    _ref?: string;\n    _key?: string;\n    _skip?: boolean;\n    data?: {[key: string]: any};\n    styles?: {[key: string]: string};\n    classes?: string[];\n    [key: string]: any;\n}\n\nexport type JsonMLFnc = (e?: HTMLElement) => void;\n\nexport interface JsonMLObj {\n    toJsonML?(): JsonML;\n}\n\nexport interface JsonML extends Array<string | Attrs | JsonML | JsonMLFnc | JsonMLObj> {\n    // 0: string;\n    // 1?: Attrs | JsonML | JsonMLFnc | JsonMObj;\n}\n\nexport interface JsonMLs extends Array<JsonML | string | JsonMLObj> {\n}\n\n\nexport interface JsonMLHandler {\n    open(tag: string, attrs: Attrs, children: number, ctx?: any): boolean;\n    close(tag: string, children: number, ctx?: any): void;\n    text(text: string, ctx?: any): void;\n    fnc(fnc: JsonMLFnc, ctx?: any): void;\n    obj(obj: JsonMLObj, ctx?: any): void;\n}\n\nexport function jsonml(jsonML: JsonML, handler: JsonMLHandler, ctx?: any): void {\n    if (!jsonML) {\n        return;\n    }\n\n    if (jsonML.length === 0 || typeof jsonML[0] !== \"string\") {\n        throw `jsonml parse error: ${JSON.stringify(jsonML)}`;\n    }\n\n    const head = jsonML[0] as string;\n    const attrsObj = jsonML[1] as any;\n    const hasAttrs = attrsObj && attrsObj.constructor === Object;\n    const childIdx = hasAttrs ? 2 : 1;\n\n    let children = 0;\n    for (let i = childIdx; i < jsonML.length; i++) {\n        if (jsonML[i] && jsonML[i].constructor !== Function) {\n            children++;\n        }\n    }\n\n    const refSplit = head.split(\"~\");\n    const ref = refSplit[1];\n    const dotSplit = refSplit[0].split(\".\");\n    const hashSplit = dotSplit[0].split(\"#\");\n    const tag = hashSplit[0] || \"div\";\n    const id = hashSplit[1];\n    const classes = dotSplit.slice(1);\n\n    let attrs: Attrs;\n    if (hasAttrs) {\n        attrs = attrsObj as Attrs;\n    } else {\n        attrs = {};\n    }\n\n    if (id) {\n        attrs._id = id;\n    }\n    if (classes.length) {\n        attrs._classes = classes;\n    }\n    if (ref) {\n        attrs._ref = ref;\n    }\n\n    const skip = handler.open(tag, attrs, children, ctx);\n\n    if (!skip) {\n        for (let i = childIdx, l = jsonML.length; i < l; i++) {\n            const jml = jsonML[i] as any;\n            if (jml === undefined) {\n                continue;\n            }\n            switch (jml.constructor) {\n                case Array:\n                    jsonml(jml, handler, ctx);\n                    break;\n                case Function:\n                    handler.fnc(jml, ctx);\n                    break;\n                case String:\n                    handler.text(jml, ctx);\n                    break;\n                case Number:\n                    handler.text(\"\" + jml, ctx);\n                    break;\n                case Boolean:\n                    handler.text(\"\" + jml, ctx);\n                    break;\n                default:\n                    handler.obj(jml, ctx);\n            }\n        }\n    }\n\n    handler.close(tag, children, ctx);\n}\n","\nimport {\n    JsonML,\n    JsonMLs,\n    JsonMLObj,\n    JsonMLFnc,\n    Attrs,\n    JsonMLHandler,\n    jsonml\n} from \"./jsonml\";\n\n\ndeclare var IncrementalDOM: any;\n\n\nclass JsonmlIDomHandler implements JsonMLHandler {\n\n    open(tag: string, attrs: Attrs, children: number, ctx?: any): boolean {\n        const props: any[] = [];\n        let id: string = attrs._id;\n        let classes: string[] = attrs._classes ? attrs._classes : [];\n        let ref: string = attrs._ref;\n        let widget: any = attrs._widget;\n        for (const a in attrs) {\n            if (attrs.hasOwnProperty(a)) {\n                switch (a) {\n                    case \"_id\":\n                    case \"_classes\":\n                    case \"_ref\":\n                    case \"_key\":\n                    case \"_skip\":\n                    case \"_widget\":\n                        break;\n                    case \"id\":\n                        id = attrs[a];\n                        break;\n                    case \"classes\":\n                        classes = classes.concat(attrs[a]);\n                        break;\n                    case \"class\":\n                        classes = classes.concat(attrs[a].split(\" \"));\n                        break;\n                    case \"data\":\n                        for (const d in attrs[a]) {\n                            if (attrs[a].hasOwnProperty(d)) {\n                                if (attrs[a][d].constructor === String) {\n                                    props.push(\"data-\" + d, attrs[a][d]);\n                                } else {\n                                    props.push(\"data-\" + d, JSON.stringify(attrs[a][d]));\n                                }\n                            }\n                        }\n                        break;\n                    case \"styles\":\n                        props.push(\"style\", attrs[a]);\n                        break;\n                    default:\n                        if (typeof attrs[a] === \"function\") {\n                            props.push(\"on\" + a, attrs[a]);\n                        } else {\n                            props.push(a, attrs[a]);\n                        }\n                }\n            }\n        }\n        if (classes.length) {\n            props.unshift(\"class\", classes.join(\" \"));\n        }\n        if (id) {\n            props.unshift(\"id\", id);\n        }\n        IncrementalDOM.elementOpen(tag, attrs._key || null, null, ...props);\n        if (attrs._skip) {\n            IncrementalDOM.skip();\n        }\n        if (ctx && ref) {\n            ctx.refs[ref] = IncrementalDOM.currentElement();\n        }\n        if (widget && \"mount\" in widget && widget.mount.constructor === Function) {\n            widget.mount(IncrementalDOM.currentElement());\n            IncrementalDOM.skip();\n        }\n        return attrs._skip ? true : false;\n    }\n\n    close(tag: string, children: number, ctx?: any): void {\n        IncrementalDOM.elementClose(tag);\n    }\n\n    text(text: string, ctx?: any): void {\n        IncrementalDOM.text(text);\n    }\n\n    fnc(fnc: JsonMLFnc, ctx?: any): void {\n        fnc(IncrementalDOM.currentElement());\n    }\n\n    obj(obj: JsonMLObj, ctx?: any): void {\n        if (\"toJsonML\" in obj) {\n            jsonml(obj.toJsonML(), this, obj);\n        } else {\n            this.text(\"\" + obj, ctx);\n        }\n    }\n\n}\n\nfunction jsonml2idom(jsonML: JsonML, ctx?: any): void {\n    jsonml(jsonML, new JsonmlIDomHandler(), ctx);\n}\n\n\nfunction jsonmls2idom(jsonMLs: JsonMLs, ctx?: any): void {\n    for (const jsonML of jsonMLs) {\n        if (jsonML.constructor === String) {\n            IncrementalDOM.text(jsonML);\n        } else if (\"toJsonML\" in (jsonML as any)) {\n            const obj = jsonML as JsonMLObj;\n            jsonml2idom(obj.toJsonML(), obj);\n        } else {\n            jsonml2idom(jsonML as JsonML, ctx);\n        }\n    }\n}\n\n\nexport function jsonml2idomPatch(node: Node, jsonML: JsonML, ctx?: any): void {\n    IncrementalDOM.patch(node,\n        (data: JsonML) => jsonml2idom(data, ctx), jsonML);\n}\n\nexport function jsonmls2idomPatch(node: Node, jsonMLs: JsonMLs, ctx?: any): void {\n    IncrementalDOM.patch(node,\n        (data: JsonMLs) => jsonmls2idom(data, ctx), jsonMLs);\n}\n","export class Hash<T> {\n\n    private _cb: (data: T) => void;\n    private _iId: any;\n\n    private _encoder = (data: T) => encodeURIComponent(JSON.stringify(data));\n    private _decoder = (data: string) => data ? JSON.parse(decodeURIComponent(data)) : undefined;\n\n    onChange(callback: (data: T) => void): this {\n        this._cb = callback;\n        if (\"onhashchange\" in window) {\n            onhashchange = () => {\n                callback(this.read());\n            };\n        } else {\n            // prest.log.warning('browser \"window.onhashchange\" not implemented, running emulation');\n            let prevHash = location.hash;\n            if (this._iId) {\n                clearInterval(this._iId);\n            }\n            this._iId = setInterval(() => {\n                if (location.hash !== prevHash) {\n                    prevHash = location.hash;\n                    callback(this.read());\n                }\n            }, 500);\n        }\n        return this;\n    }\n\n    coders(encoder: (data: T) => string, decoder: (data: string) => T): this {\n        this._encoder = encoder;\n        this._decoder = decoder;\n        return this;\n    }\n\n    start(): this {\n        this._cb(this.read());\n        return this;\n    }\n\n    read(): T {\n        const str = location.hash.slice(1);\n        return this._decoder(str);\n    }\n\n    write(hashData: T): this {\n        const str = this._encoder(hashData);\n        location.hash = \"#\" + str;\n        return this;\n    }\n\n}\n","// declare const process: any;\n// const __NODE = Boolean(\n//     typeof process === \"object\" &&\n//     process.versions &&\n//     process.versions.node);\n\n// if (__NODE) {\n//     console.log(\"I'm running in Node.JS\");\n// } else {\n//     console.log(\"I'm running in browser\");\n// }\n\nimport { JsonML, JsonMLs, JsonMLObj } from \"./jsonml\";\nimport { jsonmls2idomPatch } from \"./jsonml-idom\";\n\n\nexport interface DomWidget {\n    mount(e: HTMLElement): this;\n    umount(): this;\n    onMount?(): void;\n    onUmount?(): void;\n}\n\nexport abstract class Widget implements JsonMLObj, DomWidget {\n\n    private static __count = 0;\n\n    readonly type: string = \"Widget\"; // this.constructor.name;\n    readonly id: string = this.type + \"-\" + Widget.__count++;\n    readonly dom: HTMLElement;\n    readonly refs: { [key: string]: HTMLElement } = {};\n\n    private _updateSched: number;\n\n    constructor(type: string = \"\") {\n        if (type) {\n            this.type = type;\n        }\n    }\n\n    abstract render(): JsonMLs;\n\n    mount(e: HTMLElement = document.body): this {\n        if (\"widget\" in e) {\n            const w = (e as any).widget as Widget;\n            w && w.umount();\n        }\n        if (!this.dom) {\n            (this as any).dom = e;\n            (e as any).widget = this;\n            const jsonMLs = (this as any).render();\n            jsonmls2idomPatch(e, jsonMLs, this);\n            e.setAttribute(\"widget\", this.type);\n            if ((this as any).onMount) {\n                (this as any).onMount();\n            }\n            // onDetach(e, () => {\n            //     (this as any).dom = undefined;\n            //     if ((this as any).onUmount) {\n            //         (this as any).onUmount();\n            //     }\n            // });\n        }\n        return this;\n    }\n\n    umount(): this {\n        if (this.dom) {\n            if ((this as any).onUmount) {\n                (this as any).onUmount();\n            }\n            if (this.dom.hasAttribute(\"widget\")) {\n                this.dom.removeAttribute(\"widget\");\n            }\n            const wNodes = this.dom.querySelectorAll(\"[widget]\");\n            for (let i = 0; i < wNodes.length; i++) {\n                const w = (wNodes[i] as any).widget as Widget;\n                w && w.umount();\n            }\n            // if (this.dom.parentElement) {\n            //     this.dom.parentElement.removeChild(this.dom);\n            // }\n            while (this.dom.firstChild /*.hasChildNodes()*/) {\n                this.dom.removeChild(this.dom.firstChild);\n            }\n            (this.dom as any).widget = undefined;\n            (this as any).dom = undefined;\n        }\n        return this;\n    }\n\n    update(): this {\n        if (this.dom && !this._updateSched) {\n            this._updateSched = setTimeout(() => {\n                if (this.dom) {\n                    jsonmls2idomPatch(this.dom, this.render(), this);\n                }\n                this._updateSched = null;\n            }, 0);\n        }\n        return this;\n    }\n\n    toJsonML(): JsonML {\n        if (this.dom) {\n            if (this._updateSched) {\n                clearTimeout(this._updateSched);\n                this._updateSched = undefined;\n            } else {\n                return (\n                    [\"div\",\n                        {\n                            _skip: true,\n                            _id: this.id,\n                            _key: this.id,\n                            widget: this.type\n                        }\n                    ]\n                );\n            }\n        }\n        const jsonMLs = (this as any).render();\n        return (\n            [\"div\",\n                {\n                    _id: this.id,\n                    _key: this.id,\n                    widget: this.type\n                },\n                ...jsonMLs,\n                (e: HTMLElement) => {\n                    if (!this.dom) {\n                        (this as any).dom = e;\n                        (e as any).widget = this;\n                        if ((this as any).onMount) {\n                            (this as any).onMount();\n                        }\n                        // onDetach(e, () => {\n                        //     (this as any).dom = undefined;\n                        //     if ((this as any).onUmount) {\n                        //         (this as any).onUmount();\n                        //     }\n                        // });\n                    }\n                }\n            ]\n        );\n    }\n\n}\n\n\ndeclare var IncrementalDOM: any;\n\nIncrementalDOM.notifications.nodesDeleted = (nodes: Node[]) => {\n    nodes.forEach(node => {\n        if (node.nodeType === 1 && \"widget\" in node) {\n            const w = (node as any).widget as Widget;\n            w && w.umount();\n        }\n    });\n};\n\n\n// IncrementalDOM.notifications.nodesCreated = (nodes: Node[]) => {\n//     nodes.forEach(node => {\n//         // node may be an Element or a Text\n//         console.log(\"IncrementalDOM.notifications.nodesCreated\", node);\n//     });\n// };\n// IncrementalDOM.notifications.nodesDeleted = (nodes: Node[]) => {\n//     nodes.forEach(node => {\n//         // node may be an Element or a Text\n//         console.log(\"IncrementalDOM.notifications.nodesDeleted\", node);\n//     });\n// };\n\n\n\n// function onDetach(e: HTMLElement, callback: () => void) {\n//     new MutationObserver(mutations => {\n//         mutations.forEach(mutation => {\n//             const removed = mutation.removedNodes as any;\n//             for (const r of removed) {\n//                 console.log(r, r === e);\n//                 if (r === e) {\n//                     callback();\n//                 }\n//             }\n//         });\n//     }).observe(e.parentElement, { childList: true });\n//     // }).observe(e.parentElement, { childList: true, subtree: true });\n// }\n\n\n// const observer = new MutationObserver(mutations => {\n//     mutations.forEach(mutation => {\n//         // console.log(mutation.type);\n//         // console.log(mutation.target);\n//         // console.log(\"add\", mutation.addedNodes);\n//         // console.log(\"rm\", mutation.removedNodes);\n//         const added = mutation.addedNodes as any;\n//         for (const a of added) {\n//             console.log(\"added\", a);\n//         }\n//         const removed = mutation.removedNodes as any;\n//         for (const r of removed) {\n//             console.log(\"removed\", r);\n//         }\n//     });\n// });\n// const config = {\n//     childList: true,\n//     // attributes: true,\n//     // characterData: true,\n//     // subtree: true,\n//     // attributeOldValue: true,\n//     // characterDataOldValue: true,\n//     attributeFilter: [] as string[]\n// };\n// observer.observe(document.getElementById(\"app\"), config);\n// // observer.disconnect();\n","\nexport class Events<C> {\n\n    static any = \"\";\n\n    private _ctx: C;\n    private _cbs: { [e: string]: Array<(data: any, ctx: C, e: string) => void> };\n    private _cb: Array<(data: any, ctx: C, e: string) => void>;\n\n    constructor(ctx?: C) {\n        this._cbs = {};\n        this._ctx = ctx;\n    }\n\n    on(e: string, cb: (data: any, ctx: C, e: string) => void): this {\n        if (!e) {\n            if (!this._cb) {\n                this._cb = [];\n            }\n            this._cb.push(cb);\n        }\n        if (!(e in this._cbs)) {\n            this._cbs[e] = [];\n        }\n        if (this._cbs[e].indexOf(cb) === -1) {\n            this._cbs[e].push(cb);\n        }\n        return this;\n    }\n\n    any(cb: (data: any, ctx: C, e: string) => void): this {\n        this.on(Events.any, cb);\n        return this;\n    }\n\n    all(es: string[], cb: (data: any, ctx: C, e: string) => void): this {\n        es.forEach(e => this.on(e, cb));\n        return this;\n    }\n\n    once(e: string, cb: (data: any, ctx: C, e: string) => void): this {\n        const wrap = (d: any, c: C, ev: string) => {\n            this.off(e, wrap);\n            cb(d, c, ev);\n        };\n        this.on(e, wrap);\n        return this;\n    }\n\n    off(e: string, cb?: (data: any, ctx: C, e: string) => void): this {\n        if (!e) {\n            if (cb) {\n                this._cb.splice(this._cbs[e].indexOf(cb), 1);\n            } else {\n                this._cb.length = 0;\n                delete this._cb;\n            }\n        }\n        if (e in this._cbs) {\n            if (cb) {\n                this._cbs[e].splice(this._cbs[e].indexOf(cb), 1);\n            } else {\n                this._cbs[e].length = 0;\n                delete this._cbs[e];\n            }\n        }\n        return this;\n    }\n\n    emit(e: string, data?: any): this {\n        if (e in this._cbs) {\n            for (let i = 0, l = this._cbs[e].length; i < l; i++) {\n                this._cbs[e][i](data, this._ctx, e);\n            }\n        }\n        if (this._cb) {\n            for (let i = 0, l = this._cb.length; i < l; i++) {\n                this._cb[i](data, this._ctx, e);\n            }\n        }\n        return this;\n    }\n\n}\n\n\n// const es = new Events<number>(3);\n\n// es.any((data, ctx, e) => console.log(\"any:\", data, ctx, e));\n\n// es.emit(\"e\", \"eee1\");\n// es.on(\"e\", (data, ctx, e) => console.log(data, ctx, e));\n// es.emit(\"e\", \"eee2\");\n// es.off(\"e\");\n// es.emit(\"e\", \"eee3\");\n\n// es.off(Events.any);\n\n// es.once(Events.any, (data, ctx, e) => console.log(\"once all:\", data, ctx, e));\n\n// es.emit(\"o\", \"ooo1\");\n// es.once(\"o\", (data, ctx, e) => console.log(data, ctx, e));\n// es.emit(\"o\", \"ooo2\");\n// es.emit(\"o\", \"ooo3\");\n\n// es.all([\"e1\", \"e3\"], (data, ctx, e) => console.log(data, ctx, e));\n// es.emit(\"e1\", \"all e1\");\n// es.emit(\"e2\", \"all e2\");\n// es.emit(\"e3\", \"all e3\");\n","import { Widget } from \"./widget\";\nimport { Events } from \"./events\";\n\n\nexport abstract class WidgetE<S> extends Widget {\n\n    protected _state: S;\n\n    readonly events: Events<this>;\n\n    constructor(type: string = \"\", state?: S, events?: Events<any>) {\n        super(type);\n        this._state = state;\n        this.events = events ? events : new Events<this>(this);\n    }\n\n    setState(state: S): this {\n        this._state = state;\n        this.update();\n        return this;\n    }\n\n    getState(): S {\n        return this._state;\n    }\n\n}\n","import { WidgetE } from \"../node_modules/prest-lib/src/main/widgete\";\nimport { JsonMLs } from \"../node_modules/prest-lib/src/main/jsonml\";\n\nexport interface Todo {\n    id: number;\n    title: string;\n    completed: boolean;\n}\n\nexport interface TodoState {\n    todo: string;\n    todos: Todo[];\n    filter: string;\n    edit: number;\n}\n\nexport class TodoWidget extends WidgetE<TodoState> {\n\n    constructor() {\n        super(\"TodoWidget\");\n        this.setState({\n            todo: \"\",\n            todos: [],\n            filter: \"\",\n            edit: null\n        });\n    }\n\n    render(): JsonMLs {\n        let todos = this._state.todos;\n        const completed = this._state.todos.filter(t => t.completed);\n        const active = this._state.todos.filter(t => !t.completed);\n        switch (this._state.filter) {\n            case \"active\":\n                todos = active;\n                break;\n            case \"completed\":\n                todos = completed;\n                break;\n        }\n\n        return [\n            [\"section#app.todoapp\",\n                [\"header.header\",\n                    [\"h1\", \"todos\"],\n                    [\"input.new-todo\",\n                        {\n                            placeholder: \"What needs to be done?\",\n                            autofocus: \"autofocus\",\n                            value: new String(this._state.todo),\n                            change: this.onInsert\n                        }\n                    ]\n                ],\n                this._state.todos.length ?\n                    [\"section.main\",\n                        [\"input#toggle-all.toggle-all\",\n                            {\n                                type: \"checkbox\",\n                                change: this.onCompleteAll\n                            }\n                        ],\n                        [\"label\", { for: \"toggle-all\" },\n                            \"Mark all as complete\"\n                        ],\n                        [\"ul.todo-list\",\n                            ...todos.map(t => {\n                                    const classes = [];\n                                    t.completed && classes.push(\"completed\");\n                                    t.id === this._state.edit && classes.push(\"editing\");\n\n                                    return [\"li\", { _key: t.id, classes: classes },\n                                        [\"div.view\",\n                                            [\"input.toggle\",\n                                                {\n                                                    type: \"checkbox\",\n                                                    data: { id: t.id },\n                                                    change: this.onComplete\n                                                },\n                                                (e: HTMLInputElement) => e.checked = t.completed\n                                            ],\n                                            [\"label\",\n                                                {\n                                                    data: { id: t.id },\n                                                    dblclick: this.onEdit\n                                                },\n                                                t.title],\n                                            [\"button.destroy\",\n                                                {\n                                                    data: { id: t.id },\n                                                    click: this.onDelete\n                                                }\n                                            ]\n                                        ],\n                                        [\"input.edit\",\n                                            {\n                                                value: new String(t.title),\n                                                change: this.onEdited,\n                                                blur: this.onEdited\n                                            },\n                                            (e: HTMLInputElement) => setTimeout(() => e.select(), 0)\n                                        ]\n                                    ];\n                                })\n                        ]\n                    ] :\n                    \"\",\n                this._state.todos.length ?\n                    [\"footer.footer\",\n                        [\"span.todo-count\",\n                            [\"strong\", active.length],\n                            active.length === 1 ? \" item left\" : \" items left\"\n                        ],\n                        [\"ul.filters\",\n                            [\"li\",\n                                [\"a\",\n                                    {\n                                        href: \"#\",\n                                        classes: this._state.filter === \"\" ? [\"selected\"] : []\n                                    },\n                                    \"All\"\n                                ]\n                            ],\n                            [\"li\",\n                                [\"a\",\n                                    {\n                                        href: \"#active\",\n                                        classes: this._state.filter === \"active\" ? [\"selected\"] : []\n                                    },\n                                    \"Active\"\n                                ]\n                            ],\n                            [\"li\",\n                                [\"a\",\n                                    {\n                                        href: \"#completed\",\n                                        classes: this._state.filter === \"completed\" ? [\"selected\"] : []\n                                    },\n                                    \"Completed\"\n                                ]\n                            ]\n                        ],\n                        this._state.todos.filter(t => t.completed).length ?\n                            [\"button.clear-completed\", { click: this.onClearCompleted },\n                                \"Clear completed\"\n                            ] :\n                            \"\"\n                    ] :\n                    \"\"\n            ]\n        ];\n    }\n\n    private onInsert = (e: Event) => {\n        const title = (e.target as HTMLInputElement).value.trim();\n        if (title) {\n            this.events.emit(\"insert\", title);\n        }\n    }\n\n    private onCompleteAll = (e: Event) => {\n        const complete = (e.target as HTMLInputElement).checked;\n        this.events.emit(\"complete-all\", complete);\n    }\n\n    private onComplete = (e: Event) => {\n        const id = Number((e.target as HTMLElement).dataset.id);\n        this.events.emit(\"complete\", id);\n    }\n\n    private onDelete = (e: Event) => {\n        const id = Number((e.target as HTMLElement).dataset.id);\n        this.events.emit(\"delete\", id);\n    }\n\n    private onClearCompleted = (e: Event) => {\n        this.events.emit(\"clear-completed\");\n    }\n\n    private onEdit = (e: Event) => {\n        const id = Number((e.target as HTMLElement).dataset.id);\n        this.events.emit(\"edit\", id);\n    }\n\n    private onEdited = (e: Event) => {\n        const title = (e.target as HTMLInputElement).value.trim();\n        if (title) {\n            this.events.emit(\"edited\", title);\n        }\n    }\n\n}\n","export class Store<T> {\n\n    private static _key = \"todos-prest-lib\";\n\n    private _data: T;\n    private _isLS: boolean = false;\n\n    constructor(data: T) {\n        if (\"localStorage\" in self) {\n            try {\n                localStorage.getItem(Store._key);\n                this._isLS = true;\n            } catch (e) {\n                console.warn(e);\n            }\n        }\n        if (!this.read()) {\n            this.write(data);\n        }\n    }\n\n    read(): T {\n        return this._isLS ?\n            JSON.parse(localStorage.getItem(Store._key)) :\n            this._data;\n    }\n\n    write(data: T): void {\n        this._isLS ?\n            localStorage.setItem(Store._key, JSON.stringify(data)) :\n            this._data = data;\n    }\n\n}\n","import { Hash } from \"../node_modules/prest-lib/src/main/hash\";\nimport { TodoWidget, Todo } from \"./todowidget\";\nimport { Store } from \"./store\";\n\nexport class TodoApp {\n\n    store: Store<Todo[]>;\n    todoWidget: TodoWidget;\n    hash: Hash<string>;\n\n    constructor(element: HTMLElement, todos: Todo[] = []) {\n        this._initStore(todos);\n        this._initWidget(element);\n        this._initRouting();\n    }\n\n    private _initStore(todos: Todo[]): void {\n        this.store = new Store<Todo[]>(todos);\n    }\n\n    private _initWidget(element: HTMLElement): void {\n        this.todoWidget = new TodoWidget()\n            .setState({\n                todo: \"\",\n                todos: this.store.read(),\n                filter: \"\",\n                edit: null\n            });\n\n        this.todoWidget.events\n            .on(\"insert\", (title: string, w: TodoWidget) => {\n                const todo = {\n                    id: new Date().getTime(),\n                    title: title,\n                    completed: false\n                } as Todo;\n                w.getState().todos.push(todo);\n                w.getState().todo = \"\";\n                w.update();\n                // this.store.write(w.getState().todos);\n            })\n            .on(\"complete-all\", (complete: boolean, w: TodoWidget) => {\n                w.getState().todos.forEach(t => t.completed = complete);\n                w.update();\n                // this.store.write(w.getState().todos);\n            })\n            .on(\"complete\", (id: number, w: TodoWidget) => {\n                w.getState().todos.forEach(t => t.id === id ? t.completed = !t.completed : null);\n                w.update();\n                // this.store.write(w.getState().todos);\n            })\n            .on(\"delete\", (id: number, w: TodoWidget) => {\n                console.log(\"dddd\", id);\n                w.getState().todos = w.getState().todos.filter(t => t.id !== id);\n                w.update();\n                // this.store.write(w.getState().todos);\n            })\n            .on(\"clear-completed\", (data: any, w: TodoWidget) => {\n                w.getState().todos = w.getState().todos.filter(t => !t.completed);\n                w.update();\n                // this.store.write(w.getState().todos);\n            })\n            .on(\"edit\", (id: number, w: TodoWidget) => {\n                w.getState().edit = id;\n                w.update();\n            })\n            .on(\"edited\", (title: string, w: TodoWidget) => {\n                w.getState().todos.forEach(t => t.id === w.getState().edit ? t.title = title : null);\n                w.getState().edit = null;\n                w.update();\n                // this.store.write(w.getState().todos);\n            })\n            .any((data: any, w: TodoWidget, e: string) => {\n                console.log(e, JSON.stringify(data, null, 4));\n                console.log(\"state\", JSON.stringify(w.getState(), null, 4));\n                this.store.write(w.getState().todos);\n            });\n\n        this.todoWidget.mount(element);\n    }\n\n    private _initRouting(): void {\n        this.hash = new Hash<string>()\n        .coders(\n            data => encodeURIComponent(data),\n            str => decodeURIComponent(str)\n        )\n        .onChange(data => {\n            switch (data) {\n                case \"\":\n                case \"active\":\n                case \"completed\":\n                    this.todoWidget.getState().filter = data;\n                    this.todoWidget.update();\n                    this.todoWidget.events.emit(\"filter\", data);\n                    break;\n                default:\n                    this.todoWidget.getState().filter = \"\";\n                    this.todoWidget.update();\n                    this.todoWidget.events.emit(\"filter\", data);\n                    this.hash.write(\"\");\n                    break;\n            }\n        })\n        .start();\n    }\n\n}\n","import { TodoApp } from \"./todoapp\";\n\nconst todos = [\n    {\n        id: new Date().getTime(),\n        title: \"Learn prest-lib widgets\",\n        completed: true\n    },\n    {\n        id: new Date().getTime() + 1,\n        title: \"Add star to prest-lib\",\n        completed: false\n    }\n];\n\nconst app = new TodoApp(document.getElementById(\"app\"), todos);\n\n(self as any).app = app;\n(self as any).app.version = \"@VERSION@\";\n"],"names":["jsonML","handler","ctx","length","JSON","stringify","head","attrsObj","hasAttrs","constructor","Object","childIdx","children","i","Function","attrs","refSplit","split","ref","dotSplit","hashSplit","tag","id","classes","slice","_id","_classes","_ref","open","l","jml","undefined","Array","jsonml","fnc","String","text","Number","Boolean","obj","close","JsonmlIDomHandler","jsonMLs","jsonMLs_1","_i","IncrementalDOM","jsonml2idom","toJsonML","node","patch","data","jsonmls2idom","this","encodeURIComponent","parse","decodeURIComponent","Hash","callback","_cb","window","onhashchange","_this","read","prevHash_1","location","hash","_iId","clearInterval","setInterval","encoder","decoder","_encoder","_decoder","str","hashData","props","widget","_widget","a","hasOwnProperty","concat","d","push","unshift","join","elementOpen","_key","_skip","skip","refs","currentElement","mount","elementClose","type","Widget","__count","e","document","body","w","umount","dom","jsonmls2idomPatch","render","setAttribute","onMount","onUmount","hasAttribute","removeAttribute","wNodes","querySelectorAll","firstChild","removeChild","_updateSched","setTimeout","clearTimeout","notifications","nodesDeleted","nodes","forEach","nodeType","_cbs","_ctx","Events","cb","indexOf","on","any","es","wrap","c","ev","off","splice","state","events","_super","_state","__extends","WidgetE","update","title","target","value","trim","emit","complete","checked","dataset","setState","todo","todos","filter","edit","TodoWidget","completed","t","active","placeholder","autofocus","change","onInsert","onCompleteAll","for","map","onComplete","dblclick","onEdit","click","onDelete","onEdited","blur","select","href","onClearCompleted","self","localStorage","getItem","Store","_isLS","console","warn","write","_data","setItem","element","_initStore","_initWidget","_initRouting","TodoApp","store","todoWidget","Date","getTime","getState","log","coders","onChange","start","app","getElementById","version"],"mappings":"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"}
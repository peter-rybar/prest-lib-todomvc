!function(){"use strict";function t(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function e(t,i,o){if(t){if(0===t.length||"string"!=typeof t[0])throw"jsonml parse error: "+JSON.stringify(t);for(var n=t[0],s=t[1],r=s&&s.constructor===Object,a=r?2:1,c=0,d=a;d<t.length;d++)t[d]&&t[d].constructor!==Function&&c++;var u,h=n.split("~"),l=h[1],p=h[0].split("."),f=p[0].split("#"),g=f[0]||"div",m=f[1],_=p.slice(1);u=r?s:{},m&&(u._id=m),_.length&&(u._classes=_),l&&(u._ref=l);if(!i.open(g,u,c,o))for(var d=a,w=t.length;d<w;d++){var y=t[d];if(void 0!==y)switch(y.constructor){case Array:e(y,i,o);break;case Function:i.fnc(y,o);break;case String:i.text(y,o);break;case Number:case Boolean:i.text(""+y,o);break;default:i.obj(y,o)}}i.close(g,c,o)}}function i(t,i){e(t,new r,i)}function o(t,e){for(var o=0,n=t;o<n.length;o++){var s=n[o];if(s.constructor===String)IncrementalDOM.text(s);else if("toJsonML"in s){var r=s;i(r.toJsonML(),r)}else i(s,e)}}function n(t,e,i){IncrementalDOM.patch(t,function(t){return o(t,i)},e)}var s=function(){function t(){this._encoder=function(t){return encodeURIComponent(JSON.stringify(t))},this._decoder=function(t){return t?JSON.parse(decodeURIComponent(t)):void 0}}return t.prototype.onChange=function(t){var e=this;if(this._cb=t,"onhashchange"in window)onhashchange=function(){t(e.read())};else{var i=location.hash;this._iId&&clearInterval(this._iId),this._iId=setInterval(function(){location.hash!==i&&(i=location.hash,t(e.read()))},500)}return this},t.prototype.coders=function(t,e){return this._encoder=t,this._decoder=e,this},t.prototype.start=function(){return this._cb(this.read()),this},t.prototype.read=function(){var t=location.hash.slice(1);return this._decoder(t)},t.prototype.write=function(t){var e=this._encoder(t);return location.hash="#"+e,this},t}(),r=function(){function t(){}return t.prototype.open=function(t,e,i,o){var n=[],s=e._id,r=e._classes?e._classes:[],a=e._ref,c=e._widget;for(var d in e)if(e.hasOwnProperty(d))switch(d){case"_id":case"_classes":case"_ref":case"_key":case"_skip":case"_widget":break;case"id":s=e[d];break;case"classes":r=r.concat(e[d]);break;case"class":r=r.concat(e[d].split(" "));break;case"data":for(var u in e[d])e[d].hasOwnProperty(u)&&(e[d][u].constructor===String?n.push("data-"+u,e[d][u]):n.push("data-"+u,JSON.stringify(e[d][u])));break;case"styles":n.push("style",e[d]);break;default:"function"==typeof e[d]?n.push("on"+d,e[d]):n.push(d,e[d])}return r.length&&n.unshift("class",r.join(" ")),s&&n.unshift("id",s),IncrementalDOM.elementOpen.apply(IncrementalDOM,[t,e._key||null,null].concat(n)),e._skip&&IncrementalDOM.skip(),o&&a&&(o.refs[a]=IncrementalDOM.currentElement()),c&&"mount"in c&&c.mount.constructor===Function&&(c.mount(IncrementalDOM.currentElement()),IncrementalDOM.skip()),!!e._skip},t.prototype.close=function(t,e,i){IncrementalDOM.elementClose(t)},t.prototype.text=function(t,e){IncrementalDOM.text(t)},t.prototype.fnc=function(t,e){t(IncrementalDOM.currentElement())},t.prototype.obj=function(t,i){"toJsonML"in t?e(t.toJsonML(),this,t):this.text(""+t,i)},t}(),a=function(){function t(e){void 0===e&&(e=""),this.type="Widget",this.id=this.type+"-"+t.__count++,this.refs={},e&&(this.type=e)}return t.prototype.mount=function(t){if(void 0===t&&(t=document.body),"widget"in t){var e=t.widget;e&&e.umount()}if(!this.dom){this.dom=t,t.widget=this;n(t,this.render(),this),t.setAttribute("widget",this.type),this.onMount&&this.onMount()}return this},t.prototype.umount=function(){if(this.dom){this.onUmount&&this.onUmount(),this.dom.hasAttribute("widget")&&this.dom.removeAttribute("widget");for(var t=this.dom.querySelectorAll("[widget]"),e=0;e<t.length;e++){var i=t[e].widget;i&&i.umount()}for(;this.dom.firstChild;)this.dom.removeChild(this.dom.firstChild);this.dom.widget=void 0,this.dom=void 0}return this},t.prototype.update=function(){var t=this;return this.dom&&!this._updateSched&&(this._updateSched=setTimeout(function(){t.dom&&n(t.dom,t.render(),t),t._updateSched=null},0)),this},t.prototype.toJsonML=function(){var t=this;if(this.dom){if(!this._updateSched)return["div",{_skip:!0,_id:this.id,_key:this.id,widget:this.type}];clearTimeout(this._updateSched),this._updateSched=void 0}var e=this.render();return["div",{_id:this.id,_key:this.id,widget:this.type}].concat(e,[function(e){t.dom||(t.dom=e,e.widget=t,t.onMount&&t.onMount())}])},t.__count=0,t}();IncrementalDOM.notifications.nodesDeleted=function(t){t.forEach(function(t){if(1===t.nodeType&&"widget"in t){var e=t.widget;e&&e.umount()}})};var c=function(e){function i(t,i,o){void 0===t&&(t="");var n=e.call(this,t)||this;return n._state=i,n._actions=o,n}return t(i,e),i.prototype.setState=function(t){return this._state=t,this.update(),this},i.prototype.getState=function(){return this._state},i.prototype.setActions=function(t){return this._actions=t,this.update(),this},i.prototype.getActions=function(){return this._actions},i}(a),d=function(e){function i(){var t=e.call(this,"TodoWidget")||this;return t.onInsert=function(e){var i=e.target.value.trim();i&&t._actions.insert(i)},t.onCompleteAll=function(e){var i=e.target.checked;t._actions.completeAll(i)},t.onComplete=function(e){var i=Number(e.target.dataset.id);t._actions.complete(i)},t.onDelete=function(e){var i=Number(e.target.dataset.id);t._actions.delete(i)},t.onClearCompleted=function(e){t._actions.clearCompleted()},t.onEdit=function(e){var i=Number(e.target.dataset.id);t._actions.edit(i)},t.onEdited=function(e){var i=e.target.value.trim();i&&t._actions.edited(i)},t.setState({todo:"",todos:[],filter:"",edit:null}),t}return t(i,e),i.prototype.render=function(){var t=this,e=this._state.todos,i=this._state.todos.filter(function(t){return t.completed}),o=this._state.todos.filter(function(t){return!t.completed});switch(this._state.filter){case"active":e=o;break;case"completed":e=i}return[["section#app.todoapp",["header.header",["h1","todos"],["input.new-todo",{placeholder:"What needs to be done?",autofocus:"autofocus",value:new String(this._state.todo),change:this.onInsert}]],this._state.todos.length?["section.main",["input#toggle-all.toggle-all",{type:"checkbox",change:this.onCompleteAll}],["label",{for:"toggle-all"},"Mark all as complete"],["ul.todo-list"].concat(e.map(function(e){var i=[];return e.completed&&i.push("completed"),e.id===t._state.edit&&i.push("editing"),["li",{_key:e.id,classes:i},["div.view",["input.toggle",{type:"checkbox",data:{id:e.id},change:t.onComplete},function(t){return t.checked=e.completed}],["label",{data:{id:e.id},dblclick:t.onEdit},e.title],["button.destroy",{data:{id:e.id},click:t.onDelete}]],["input.edit",{value:new String(e.title),change:t.onEdited,blur:t.onEdited},function(t){return setTimeout(function(){return t.select()},0)}]]}))]:"",this._state.todos.length?["footer.footer",["span.todo-count",["strong",o.length],1===o.length?" item left":" items left"],["ul.filters",["li",["a",{href:"#",classes:""===this._state.filter?["selected"]:[]},"All"]],["li",["a",{href:"#active",classes:"active"===this._state.filter?["selected"]:[]},"Active"]],["li",["a",{href:"#completed",classes:"completed"===this._state.filter?["selected"]:[]},"Completed"]]],this._state.todos.filter(function(t){return t.completed}).length?["button.clear-completed",{click:this.onClearCompleted},"Clear completed"]:""]:""]]},i}(c),u=function(){function t(t,e){this.widget=t,this.store=e}return t.prototype.insert=function(t){var e={id:(new Date).getTime(),title:t,completed:!1};this.widget.getState().todos.push(e),this.widget.getState().todo="",this.widget.update(),this.store.write(this.widget.getState().todos)},t.prototype.completeAll=function(t){this.widget.getState().todos.forEach(function(e){return e.completed=t}),this.widget.update(),this.store.write(this.widget.getState().todos)},t.prototype.complete=function(t){this.widget.getState().todos.forEach(function(e){return e.id===t?e.completed=!e.completed:null}),this.widget.update(),this.store.write(this.widget.getState().todos)},t.prototype.delete=function(t){this.widget.getState().todos=this.widget.getState().todos.filter(function(e){return e.id!==t}),this.widget.update(),this.store.write(this.widget.getState().todos)},t.prototype.clearCompleted=function(){this.widget.getState().todos=this.widget.getState().todos.filter(function(t){return!t.completed}),this.widget.update(),this.store.write(this.widget.getState().todos)},t.prototype.edit=function(t){this.widget.getState().edit=t,this.widget.update()},t.prototype.edited=function(t){var e=this;this.widget.getState().todos.forEach(function(i){return i.id===e.widget.getState().edit?i.title=t:null}),this.widget.getState().edit=null,this.widget.update(),this.store.write(this.widget.getState().todos)},t.prototype.filter=function(t){this.widget.getState().filter=t,this.widget.update()},t}(),h=function(){function t(e){if(this._isLS=!1,"localStorage"in self)try{localStorage.getItem(t._key),this._isLS=!0}catch(t){console.warn(t)}this.read()||this.write(e)}return t.prototype.read=function(){return this._isLS?JSON.parse(localStorage.getItem(t._key)):this._data},t.prototype.write=function(e){this._isLS?localStorage.setItem(t._key,JSON.stringify(e)):this._data=e},t._key="todos-prest-lib",t}(),l=function(){function t(t,e){void 0===e&&(e=[]),this._initStore(e),this._initWidget(t),this._initRouting()}return t.prototype._initStore=function(t){this.store=new h(t)},t.prototype._initWidget=function(t){this.todoWidget=(new d).setState({todo:"",todos:this.store.read(),filter:"",edit:null}),this.todoWidget.setActions(new u(this.todoWidget,this.store)).mount(t)},t.prototype._initRouting=function(){var t=this;this.hash=(new s).coders(function(t){return encodeURIComponent(t)},function(t){return decodeURIComponent(t)}).onChange(function(e){switch(e){case"":case"active":case"completed":t.todoWidget.getActions().filter(e);break;default:t.todoWidget.getActions().filter(e),t.hash.write("")}}),this.hash.start()},t}(),p=[{id:(new Date).getTime(),title:"Learn prest-lib widgets",completed:!0},{id:(new Date).getTime()+1,title:"Add star to prest-lib",completed:!1}],f=new l(document.getElementById("app"),p);self.app=f,self.app.version="0.1.0"}();
//# sourceMappingURL=index.js.map
